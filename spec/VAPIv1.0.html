<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Vehicle API version 1.0 (VAPIv1.0)</title>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class='remove' defer></script>
    <script class='remove'>
      var respecConfig = {
        latestVersion: null,
        github: "https://github.com/UlfBj/vehicle-api",
        specStatus: "base",
        editors: [{
          name: "Ulf Bjorkengren",
          company: "Ford Motor Company",
          companyURL: "https://www.ford.com",
        }],
        edDraftURI: "https://github.com/UlfBj/vehicle-api/tree/main/spec/VAPIv1.0.html",
        shortName: "vapi1.0",
        localBiblio: {
          "VISS": {
            title: "COVESA VISS version 3.0",
            href: "https://raw.githack.com/COVESA/vehicle-information-service-specification/releases/tag/v3.0",
            publisher: "Ulf Bjorkengren; Wonsuk Lee"
          }
        }
      };
    </script>
    <style>
      table.parameters, table.exceptions {
          border-spacing: 0;
          border-collapse:    collapse;
          margin: 0.5em 0;
          width:  100%;
      }
      table.parameters { border-bottom:  1px solid #90b8de; }
      table.exceptions { border-bottom:  1px solid #deb890; }

      .parameters th, .exceptions th {
          color:  inherit;
          padding:    3px 5px;
          text-align: left;
          font-weight:    normal;
      }
      .parameters th { color: #fff; background: #005a9c; }
      .exceptions th { background: #deb890; }

      .parameters td, .exceptions td {
          padding:    3px 10px;
          border-top: 1px solid #ddd;
          vertical-align: top;
      }

      .parameters tr:first-child td, .exceptions tr:first-child td {
          border-top: none;
      }

      .parameters td.prmName, .exceptions td.excName, .exceptions td.excCodeName {
          width:  100px;
      }

      .parameters td.prmType {
          width:  120px;
      }

      table.exceptions table {
          border-spacing: 0;
          border-collapse:    collapse;
          width:  100%;
      }

      .simple {
        width:100%;
      }

      thead th{
        border-bottom: 1px solid black;
      }

      .simple tbody th{
        width:33%;
        background: white;
        color: black;        
      }
      pre { white-space: pre-wrap;}
  </style>    
  </head>
  <body>
    <section id='abstract'>
      <p>
        The Vehicle API (VAPI) specification defines an interface for access to vehicle signals and services.
        This access is realized by exposing a procedure-based interface to clients of it.
        For vehicle services there i a one-to-one mapping between a service and a procedure.
        For signals there are a set of reserved procedure signatures that are used to realize the signal access.
        This specification is agnostic to the connectivity solution that is used in implementations of it.
        A client may be deployed in-vehicle, but may also be deployed off-vehicle.
        These details are abstracted in the interface and dealt with in the implementation of the interface.
      </p>
    </section>

    <section id="introduction">
      <h2>Introduction</h2>
      <p>
      This specification defines an interface for access to vehicle signals and services.
      </p>
    </section>

    <section id="conformance"></section>

    <section id="terminology">
      <h2>Terminology</h2>
      <p>
      The acronym 'VAPIv1.0' is used to refer to this document, the VAPI version 1.0 specification.<br>
      The acronym 'VSS' is used to refer to the <a href="https://github.com/COVESA/vehicle_signal_specification">'Vehicle Signal Specification'</a>
      which is hosted by COVESA.<br>
      The acronym 'HIM' is used to refer to the <a href="https://github.com/COVESA/hierarchical_information_model">'Hierarchical Information Specification'</a>
      which is hosted by COVESA.<br>
      The acronym 'VISS' is used to refer to the <a href="https://github.com/COVESA/vehicle-information-service-specification">'Vehicle Information Service Specification'</a>
      which is hosted by COVESA.<br>
      The acronym 'CVIS' is used to refer to the <a href="https://github.com/COVESA/commercial-vehicle-information-specifications">
      'Commercial Vehicle Information Specifications'</a> which is hosted by COVESA.
      </p>
    </section>

    <section id="vapi-overview">
      <h2>VAPI Overview</h2>
      <p>
        VAPI procedures are characterized as belonging to one of the types Common, Signal, or Service.
      <ul>
          <li>
            The Common type contains the procedures that common to both signal and service access.
          </li>
          <li>
            The Signal type contains the procedures that a client may use for access to vehicle signals.
          </li>
          <li>
            The Service type contains the procedures that a client may use for access to vehicle services.
          </li>
      </ul>
      <strong>Procedure characteristics:</strong>
      <ul>
        <li>
        Procedures that are invoked to a specific vehicle must include a vehicle ID as input parameter.
        </li>
        <li>
        Procedures representing services with an extended execution time shall include a pointer to a callback procedure as input parameter.
        The procedure implementation must invoke the callback procedure at the successful termination of the service, or if the service terminates unsuccessfully.
        It may issue further callback invokations during the execution.
        A client that does not want to receive callbacks shall set the input callback pointer to nil.
        </li>
        <li>
        The output data that is defined in the procedure signature must contain a ProcedureStatus parameter and an ErrorData parameter.<br>
        If the ProcedureStatus parameter is set to indicate unsuccessful execution then the ErrorData must be populated with information about the failure,
        else the poiner to it shall be set to nil.<br>
        The output data may include service specific parameters.<br>
        If the service does not terminate successfully then all service specific output parameters are invalid.<br>
        The output data shall be returned synchronously with the call of the service.
        Any asynchronous event messages shall use the same output data structure.<br>
        The output data shall be contained in a single struct.
        </li>
        <li>
        Procedures with an extended execution time must return a unique reference to the execution session.
        A client may use this reference to asynchronously terminate the ongoing execution.
        </li>
        <li>
        Procedures that change the state of the vehicle can typically not be executed in multiple parallelly executing instances,
        while the opposite is typically true for procedures that do not change the state of the vehicle.<br>
        Procedures that do not support multiple execution instances must set the Status to ONGOING in the output if it is called
        during execution of a previous call.<br>
        It shall be stated in the procedure documentation if it supports multiple execution instances.
        If not stated then it shall not support multiple execution instances.
        </li>
        <li>
        Procedures calls are agnostic to which transport protocol that is used.
        If a session-based protocol is used then a successful <a href="#connect-procedure">Connect</a> call must have preceeded this call.
        </li>
      </ul>
      </p>
    </section>

    <section id="common-procedures">
      <h2>Common Procedures</h2>
      <p>
      The common procedures provide the following services.
      </p>
      <ul>
        <li>
        <a href="#getvehicle-procedure">Initiate a connection session to a vehicle</a>.
        </li>
        <li>
        <a href="#connect-procedure">Connect for a session with a vehicle</a>.
        </li>
        <li>
        <a href="#service-inquiry-procedure">Inquire a vehicle about the services it supports</a>.
        </li>
        <li>
        <a href="#disconnect-procedure">Terminate the connection session to a vehicle</a>.
        </li>
        <li>
        <a href="#cancel-service-procedure">Cancel an ongoing procedure execution</a>.
        </li>
        <li>
        <a href="#get-st-credentials-procedure">Request for short term credentials</a>.
        </li>
        <li>
        <a href="#invoke-procedure">Invoke a service that is not part of the VAPI specification</a>.
        </li>
      </ul>
      <section id="getvehicle-procedure">
        <h2>GetVehicle</h2>
        <p>Provides a vehicle reference and connectivity info for a specified vehicle.</p>

        <p>
        This procedure tries to retrieve connectivity data for the vehicle that is associated with the input vehicle globally unique identity.
        This identity may be a pseudo-VIN that has been derived from the vehicle VIN.
        How the client has obtained this identity is out-of-scope for this specification.
        If it succeeds it will return a vehicle Id that shall be used as input in the procedures that require a vehicle Id,
        and data about which protocols that are available for connecting to it.
        </p>

        <section id="getvehicle-signature">
          <h2>Signature</h2>
          <pre><code>GetVehicle(vehicleGuid: string): GetVehicleOutput</code></pre>
        </section>

        <section id="getvehicle-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleGuid</strong> (<span class="type">string</span>)
              <br>
              A globally unique reference to the vehicle.
            </li>
          </ul>
        </section>

        <section id="getvehicle-returns">
          <h2>Returns</h2>
            <span class="type"><code>GetVehicleOutput</code></span>
            <br>
            A struct containing the output data from the GetVehicle procedure.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              VehicleId: uint32,
              Protocol: []string
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            VehicleId: The reference to the vehicle that shall be used as input in procedures that require a vehicle id.
            The scope of this Id is limited to run-time scope of the client calling GetVehicle.<br>
            <a href="#supported-protocol">Protocol: </a>A list of supported protocols.
        </section>

        <section id="getvehicle-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall at least support the error cases:
            <ul>
              <li>
              Unknown globally unique vehicle identity.
              </li>
              <li>
              Vehicle connection data not available.
              </li>
              <li>
              Connecting to vehicle failed.
              </li>
            </ul>
            </li>
            <li>
             The VehicleId and Protocol parameters are invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
      </section>

      <section id="releasevehicle-procedure">
        <h2>ReleaseVehicle</h2>
      </section>

      <section id="connect-procedure">
        <h2>Connect</h2>
        <p>Sets up a connectivity session with a vehicle.</p>

        <p>
        This procedure sets up a connection with the vehicle over the specified protocol.
        It must be called for any session-based protocol before invoking any service over it.
        </p>

        <section id="connect-signature">
          <h2>Signature</h2>
          <pre><code>Connect(vehicleId: uint32, protocol: string, clientCredentials: string): ConnectOutput</code></pre>
        </section>

        <section id="connect-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
            <li>
              <strong>protocol</strong> (<span class="type">string</span>)
              <br>
              If the connectivity solution that is used by the VAPI implementation supports use of multiple transport
              protocols then this parameter allows the client to select which to use.
              The names representing the supported protocols must align with the names used by the implemented connectivity solution.
            </li>
            <li>
              <strong>clientCredentials</strong> (<span class="type">string</span>)
              <br>
              Access to the vehicle services or signals might require that a credential is present, e .g. a certificate.
              How the client obtains this credential is out-of-scope for this specification,
              as well as what is required of it to become verified successfully.
              This information may be available in the context of the implemented connectivity solution.
              If it is not required then it shall be set to an empty string.
            </li>
          </ul>
        </section>

        <section id="connect-returns">
          <h2>Returns</h2>
            <span class="type"><code>ConnectOutput</code></span>
            <br>
            A struct containing the output data from the Connect procedure.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              LtCredential: string
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            LtCredential: Long term credentials that may have a lifetime equal to the vehicle connectivity session.
            If not used then it is set to an empty string.
        </section>

        <section id="connect-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall at least support the error cases:
            <ul>
              <li>
              Unknown globally unique vehicle identity.
              </li>
              <li>
              Vehicle connection data not available.
              </li>
              <li>
              Connecting to vehicle failed.
              </li>
            </ul>
            </li>
            <li>
             The LtCredential parameter is invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
      </section>

      <section id="disconnect-procedure">
        <h2>Disconnect</h2>
      </section>

      <section id="select-protocol-procedure">
        <h2>SelectProtocol</h2>
      </section>

      <section id="cancel-service-procedure">
        <h2>CancelService</h2>
      </section>

      <section id="service-inquiry-procedure">
        <h2>ServiceInquiry</h2>
        <p>Inquiry to a vehicle about auxillary services that it supports.</p>

        <p>
        This procedure inquires a vehicle about any auxillary services that it supports.
        These services can then be called by calling the <a href="#invoke-procedure">Invoke</a> procedure.
        </p>

        <section id="service-inquiry-signature">
          <h2>Signature</h2>
          <pre><code>ServiceInquiry(vehicleId: uint32): ServiceInquiryOutput</code></pre>
        </section>

        <section id="service-inquiry-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
          </ul>
        </section>

        <section id="service-inquiry-returns">
          <h2>Returns</h2>
            <span class="type"><code>ServiceInquiryOutput</code></span>
            <br>
            A struct containing the output data from the ServiceInquiry procedure.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              Service: []ServiceSignature
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            <a href="#service-signature">Service: </a>An array of structs describing the service signature.
        </section>

        <section id="service-inquiry-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall at least support the error cases:
            <ul>
              <li>
              Unknown globally unique vehicle identity.
              </li>
              <li>
              Vehicle connection data not available.
              </li>
              <li>
              Connecting to vehicle failed.
              </li>
            </ul>
            </li>
            <li>
             The Service parameter is invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
      </section>

      <section id="get-st-credentials-procedure">
        <h2>GetStCredentials</h2>
        <p>Get the vehicle short term credentials.</p>

        <p>
        This procedure is used by the client to obtain the short term credentials that can be used to access vehicle signals/services for a specific
        use case / purpose.
        </p>

        <section id="get-st-credentials-signature">
          <h2>Signature</h2>
          <pre><code>GetStCredentials(vehicleId: uint32, LtCredential string, purpose string): GetStCredentialsOutput</code></pre>
        </section>

        <section id="get-st-credentials-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
            <li>
              <strong>LtCredential</strong> (<span class="type">string</span>)
              <br>
              The long term credentials that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
              If it is not required then it shall be set to an empty string.
            </li>
            <li>
              <strong>purpose</strong> (<span class="type">string</span>)
              <br>
              A description of the use case / purpose for the client access to the signals/service.
              If not required it shall be set to an empty string.
              The string representing the purpose must align with the purposes supported by the ecosystem around the implemented connectivity solution.
            </li>
          </ul>
        </section>

        <section id="get-st-credentials-returns">
          <h2>Returns</h2>
            <span class="type"><code>GetStCredentialsOutput</code></span>
            <br>
            A struct containing the output data from the GetStCredentials procedure.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              StCredentials: string
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            StCredentials: Short term credentials that have a lifetime  less than or equal to the vehicle connectivity session.
            If not required for the client to get access then it shall be set to an empty string.
        </section>

        <section id="get-st-credentials-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall at least support the error cases:
            <ul>
              <li>
              Unknown globally unique vehicle identity.
              </li>
              <li>
              Vehicle connection data not available.
              </li>
              <li>
              Connecting to vehicle failed.
              </li>
            </ul>
            </li>
            <li>
             The StCredentials parameter is invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
      </section>

      <section id="invoke-procedure">
        <h2>Invoke</h2>
        <p>The Invoke procedure is used to call auxillary services that are not part of the VAPI specification.</p>

        <p>
        If a service that is not part of the VAPI specification has been installed in the vehicle then information about it shall be
        accessible to the client by calling either the <a href="#service-inquiry-procedure">ServiceInquiry</a>
        or the <a href="#getmetadata-procedure">GetMetadata</a> procedure.
        </p>

        <section id="invoke-signature">
          <h2>Signature</h2>
          <pre><code>Invoke(vehicleId: uint32, serviceName: string, procedureInput: string, stCredentials: string, callback: *fcn(InvokeOutput): InvokeOutput</code></pre>
        </section>

        <section id="Invoke-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
            <li>
              <strong>serviceName</strong> (<span class="type">string</span>)
              <br>
            </li>
            The name of the auxillary service.
            <li>
              <strong>procedureInput</strong> (<span class="type">string</span>)
              <br>
              The input parameters of the service to be called are supplied as a JSON object.
              The syntax shall be as follows with both parameter names and values represented as strings (two input parameters in the example).
            <pre><code>
              {
                  "parameterName1": "value1",
                  "parameterName2": "value2"
              }          
              </code></pre>
              An empty string represents the case with a service having no input parameters.
            </li>
            <li>
              <strong>stCredentials</strong> (<span class="type">string</span>)
              <br>
              The short term credentials that was obtained by a call to <a href="#get-st-credentials-procedure">GetStCredentials</a>.
            </li>
            <li>
              <strong>callback</strong> (<span class="type">*fcn(InvokeOutput)</span>)
              <br>
              A pointer to a callback function that is called if an event message gets issued by the service.
              If set to nil callbacks will not be issued.
            </li>
          </ul>
        </section>

        <section id="invoke-returns">
          <h2>Returns</h2>
            <span class="type"><code>InvokeOutput</code></span>
            <br>
            A struct containing the output data from the Invoke procedure.
            This shall be returned both synchronously on the procedure call and asynchronously on event trigger conditions.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              ServiceOutput: string,
              ServiceId: uint32
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            ServiceOutput: The service output parameters is a JSON object following the same syntax as used for the input parameters.<br>
            ServiceId: A reference to the service session that the client may use to call <a href="#cancel-service-procedure">CancelService</a>.
            It may be set to zero in which case it is invalid.
        </section>

        <section id="invoke-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall conform to the error data definitions in [[VISS]] for signals.
            </li>
            <li>
             The ServiceOutput and ServiceId parameters are invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
      </section>

      <section id="getmetadata-procedure">
        <h2>GetMetadata</h2>
        <p>GetMetadata is used to get the metadata that defines a signal or service.</p>

        <p>
        GetMetadata retrieves the metadata from the subtree with the root node that the input path points to.
        The subtree can contain either signal metadata or service metadata.
        </p>

        <section id="getmetadata-signature">
          <h2>Signature</h2>
          <pre><code>GetMetadata(vehicleId: uint32, path: string, stCredentials: string, callback: *fcn(GetMetadataOutput): GetMetadataOutput</code></pre>
        </section>

        <section id="getmetadata-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
            <li>
              <strong>path</strong> (<span class="type">string</span>)
              <br>
              The path must follow the syntax described in HIM. It may address any node in the HIM defined tree.
            </li>
            <li>
              <strong>stCredentials</strong> (<span class="type">string</span>)
              <br>
              The short term credentials that was obtained by a call to <a href="#get-st-credentials-procedure">GetStCredentials</a>.
            </li>
            <li>
              <strong>callback</strong> (<span class="type">*fcn(getmetadataOutput)</span>)
              <br>
              A pointer to a callback function that is called if an event message gets issued by the service.
              If set to nil callbacks will not be issued.
            </li>
          </ul>
        </section>

        <section id="getmetadata-returns">
          <h2>Returns</h2>
            <span class="type"><code>GetMetadataOutput</code></span>
            <br>
            A struct containing the output data from the GetMetadata procedure.
            This shall be returned both synchronously on the procedure  call and asynchronously on event trigger conditions.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              Metadata: string,
              ServiceId: uint32
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            Metadata: A JSON object containing the metadata from the signals or services in the subtree.<br>
            ServiceId: A reference to the service session that the client may use to call <a href="#cancel-service-procedure">CancelService</a>.
            It may be set to zero in which case it is invalid.
        </section>

        <section id="getmetadata-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall conform to the error data definitions in [[VISS]] for signals.
            </li>
            <li>
             The Metadata and ServiceId parameters are invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>

      </section>

    </section>

    <section id="signal-procedures">
      <h2>Signal Procedures</h2>
      <p>
      xxx
      </p>

      <section id="get-procedure">
        <h2>Get</h2>
        <p>Get the value of one or more signals.</p>

        <p>This procedure retrieves the latest available value with associated timestamp of the signal that is referenced by the input path.
        It is possible to reference multiple signals in one call.<br>
        This procedure supports multiple execution instances.
        </p>

        <section id="get-signature">
          <h2>Signature</h2>
          <pre><code>Get(vehicleId: uint32, path: string, filter: string, stCredentials: string): GetOutput</code></pre>
        </section>

        <section id="get-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
            <li>
              <strong>path</strong> (<span class="type">string</span>)
              <br>
              The path must follow the syntax described in HIM. It must address a leaf node in the HIM defined tree, unless there is also an input filter parameter.
            </li>
            <li>
              <strong>filter</strong> (<span class="type">string</span>)
              <br>
              If the path addresses a branch node in the HIM defined tree, then a filter must be used to extend it to one or more leaf nodes.
              The filter expression must follow the syntax as described in the implemented connectivity solution.
            </li>
            <li>
              <strong>stCredentials</strong> (<span class="type">string</span>)
              <br>
              The short term credentials that was obtained by a call to <a href="#get-st-credentials-procedure">GetStCredentials</a>.
            </li>
          </ul>
        </section>

        <section id="get-returns">
          <h2>Returns</h2>
            <span class="type"><code>GetOutput</code></span>
            <br>
            A struct containing the output data from the Get procedure.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              Data: []DataContainer
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            <a href="#data-container">Data: </a>The requested signal data.
        </section>

        <section id="get-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall conform to the error data definitions in [[VISS]] for signals.
            </li>
            <li>
             The Data parameter is invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
      </section>

      <section id="set-procedure">
        <h2>Set</h2>
        <p>
        xxx
        </p>
      </section>

      <section id="subscribe-procedure">
        <h2>Subscribe</h2>
        <p>Subscribe to receiving event messages containing one or more signals.</p>

        <p>
        Subscribe initiates a session in which the values of one or more signals are asynchronously returned depending on the event trigger condition.
        It is possible to reference multiple signals in one call.
        </p>

        <section id="subscribe-signature">
          <h2>Signature</h2>
          <pre><code>Subscribe(vehicleId: uint32, path: string, filter: string, stCredentials: string, callback: *fcn(SubscribeOutput): SubscribeOutput</code></pre>
        </section>

        <section id="subscribe-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
            <li>
              <strong>path</strong> (<span class="type">string</span>)
              <br>
              The path must follow the syntax described in HIM. It must address a leaf node in the HIM defined tree, unless there is also an input filter parameter.
            </li>
            <li>
              <strong>filter</strong> (<span class="type">string</span>)
              <br>
              If the path addresses a branch node in the HIM defined tree, then a filter must be used to extend it to one or more leaf nodes.
              The filter expression must follow the syntax as described in [[VISS]].
            </li>
            <li>
              <strong>stCredentials</strong> (<span class="type">string</span>)
              <br>
              The short term credentials that was obtained by a call to <a href="#get-st-credentials-procedure">GetStCredentials</a>.
            </li>
            <li>
              <strong>callback</strong> (<span class="type">*fcn(SubscribeOutput)</span>)
              <br>
              A pointer to a callback function that is called if an event message gets issued by the service.
              If set to nil callbacks will not be issued.
            </li>
          </ul>
        </section>

        <section id="subscribe-returns">
          <h2>Returns</h2>
            <span class="type"><code>SubscribeOutput</code></span>
            <br>
            A struct containing the output data from the Subscribe procedure.
            This shall be returned both synchronously on the procedure  call and asynchronously on event trigger conditions.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              Data: []DataContainer,
              ServiceId: uint32
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            <a href="#data-container">Data: </a>The requested signal data.<br>
            ServiceId: A reference to the service session that the client may use to call <a href="#cancel-service-procedure">CancelService</a>.
            It may be set to zero in which case it is invalid.

        </section>

        <section id="subscribe-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall conform to the error data definitions in [[VISS]] for signals.
            </li>
            <li>
             The Data and ServiceId parameters are invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
      </section>

      <section id="unsubscribe-procedure">
        <h2>Unsubscribe</h2>
        <p>
        xxxx
        </p>
      </section>
    </section>
    </section>
  </section>

  <section id="service-procedures">
    <h2>Service Procedures</h2>
    <p>
    The vehicle services are structured into service groups where each group contains services that relates to a vehicle domain.
    The service groups supported by VAPI are listed below.
    <ul>
      <li>
      <strong><a href="#seating-service-group">Seating</a></strong>
      </li>
      <li>
      <strong><a href="#hvac-service-group">HVAC</a></strong>
      </li>
      <li>
      <strong><a href="#exterior-lighting-service-group">Exterior lighting</a></strong>
      </li>
      <li>
      <strong><a href="#interior-lighting-service-group">Interior lighting</a></strong>
      </li>
    </ul>
    </p>

    <section id="seating-service-group">
      <h2>Seating Service Group</h2>
      <p>
      The seating service group consists of all services related to the vehicle seating.
      </p>

    <section id="get-properties-seating-procedure">
      <h2>GetPropertiesSeating</h2>
        <p>Get the available properties for seating in the vehicle.</p>

        <p>This procedure retrieves the properties related to the seating service group.<br>
        This procedure supports multiple execution instances.
        </p>

        <section id="get-properties-seating-signature">
          <h2>Signature</h2>
          <pre><code>GetPropertiesSeating(vehicleId: uint32): GetPropertiesSeatingOutput</code></pre>
        </section>

        <section id="get-properties-seating-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
          </ul>
        </section>

        <section id="get-properties-seating-returns">
          <h2>Returns</h2>
            <span class="type"><code>GetPropertiesSeatingOutput</code></span>
            <br>
            A struct containing the output data from the GetPropertiesSeating procedure.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              Id: RaggedMatrix
              Movement: []SeatMovementType
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            <a href="#ragged-matrix">Id: </a>A ragged matrix of seat identities.<br>
            <a href="#seat-movement">Movement: </a>An array of structs describing the seat movement types.
        </section>

        <section id="get-properties-seating-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall conform to the error data definitions in [[VISS]] for signals.
            </li>
            <li>
             The Id and Movement parameters are invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
    </section>

    <section id="move-seat-procedure">
      <h2>MoveSeat</h2>
        <p>Performs all possible seat movements.</p>

        <p>
        This procedure performs all possible types of seat movements.
        It supports "synchronous" movement to any position provided as input to the service, 
        and also "asynchronous" movement where the client terminates the service execution by invokation of <a href="#cancel-service-procedure">CancelService</a>.
        In the asynchronous scenario the provided input to the service is typically one of the position range end points (zero or hundred percent).
        </p>

        <section id="move-seat-signature">
          <h2>Signature</h2>
          <pre><code>MoveSeat(vehicleId: uint32, seatId: MatrixId, movementType: string, position: Percentage,
          stCredentials: string, callback: *fcn(MoveSeatOutput): MoveSeatOutput</code></pre>
        </section>

        <section id="move-seat-parameters">
          <h2>Parameters</h2>
          <ul class="param-list">
            <li>
              <strong>vehicleId</strong> (<span class="type">uint32</span>)
              <br>
              A reference to the vehicle that was obtained in a previous <a href="#getvehicle-procedure">GetVehicle</a>.
            </li>
            <li>
              <strong>seatId</strong> (<span class="type"><a href="#matrix-id">MatrixId</a></span>)
              <br>
              The seat Id identifies one of the seats in the vehicle.
            </li>
            <li>
              <strong>movementType</strong> (<span class="type">string</span>)
              <br>
              The seat movement type must be one of the SeatMovements elements retrieved by <a href="#get-properties-seating-procedure">GetPropertiesSeating</a>.
            </li>
            <li>
              <strong>position</strong> (<span class="type"><a href="#percentage">Percentage</a></span>)
              <br>
              The seat movement regardless of type is expressed in a percentage where zero (0) is one end position and hundred (100) is the other end position.
            </li>
            <li>
              <strong>stCredentials</strong> (<span class="type">string</span>)
              <br>
              The short term credentials that was obtained by a call to <a href="#get-st-credentials-procedure">GetStCredentials</a>.
            </li>
            <li>
              <strong>callback</strong> (<span class="type">*fcn(MoveSeatOutput)</span>)
              <br>
              A pointer to a callback function that is called if an event message gets issued by the service.
              If set to nil callbacks will not be issued.
            </li>
          </ul>
        </section>

        <section id="move-seat-returns">
          <h2>Returns</h2>
            <span class="type"><code>MoveSeatOutput</code></span>
            <br>
            A struct containing the output data from the Subscribe procedure.
            This shall be returned both synchronously on the procedure  call and asynchronously on event trigger conditions.
            <pre><code>
            {
              Status: ProcedureStatus,
              Error: *ErrorData,
              Position: Percentage,
              ServiceId: uint32
            }
            </code></pre>
            Struct member descriptions:<br>
            <a href="#procedure-status">Status: </a>The status of the latest service call to it.<br>
            <a href="#error-data">Error: </a>Error information for the latest service call, if error occurred.<br>
            <a href="#percentage">Position: </a>The current position of the seat movement.<br>
            ServiceId: A reference to the service session that the client may use to call <a href="#cancel-service-procedure">CancelService</a>.
            It may be set to zero in which case it is invalid.
        </section>

        <section id="move-seat-error">
          <h2>Error</h2>
          <ul class="error-list">
            <li>
            If Status is set to FAILED then Error must be available and populated with error data, else the pointer to Error shall be set to nil.
            </li>
            <li>
            Error data shall conform to the error data definitions in [[VISS]] for signals.
            </li>
            <li>
             The Position and ServiceId parameters are invalid if Status is set to FAILED.
            </li>
          </ul>
        </section>
    </section>
  </section>

  <section id="hvac-service-group">
    <h2>HVAC Service Group</h2>
    <p>
      The HVAC service group consists of all services related to the vehicle HVAC functionality.
    </p>

    <section id="xxx-procedure">
      <h2>xxx Procedure</h2>
      <p>
      xxx
      </p>
    </section>
  </section>

  <section id="exterior-lighting-service-group">
    <h2>Exterior Lighting Service Group</h2>
    <p>
      The Exterior lighting service group consists of all services related to the vehicle exterior lighting.
    </p>

    <section id="xxx-procedure">
      <h2>xxx Procedure</h2>
      <p>
      xxx
      </p>
    </section>
  </section>

  <section id="interior-lighting-service-group">
    <h2>Interior Lighting Service Group</h2>
    <p>
      The Interior lighting service group consists of all services related to the vehicle interior lighting.
    </p>

    <section id="xxx-procedure">
      <h2>xxx Procedure</h2>
      <p>
      xxx
      </p>
    </section>
  </section>
  </section>

  <section id="datatype-definitions">
    <h2>Datatype Definitions</h2>
    <p>
    Datatypes that are used by multiple procedures are defined below.
    </p>

      <section id="error-data">
        <h2>ErrorData</h2>
        A struct containing the error data related to a failed procedure call.<br>
        The Code shall conform to the status codes defined in [[RFC2616]].<br>
        The Reason shall be the associated reason phrase from the referenced RFC document.<br>
        The Description shall provide more context of the failure.
        <pre><code>
        struct {
            Code: int32,
            Reason: string,
            Description: string
        }
        </code></pre>
      </section>

      <section id="data-container">
        <h2>DataContainer</h2>
        A struct containing the path of a signal and one or more data points for the signal.
        <pre><code>
        struct {
            Path: string,
            SignalData: []DataPoint
        }
        </code></pre>
      </section>

      <section id="data-point">
        <h2>DataPoint</h2>
        A struct containing one data point. A data point contains a signal value and its associated timestamp.
        The value has string format which is used to represent the value for any of the datatypes supported by HIM.
        <pre><code>
        struct {
            Value: string,
            Timestamp: string
        }
        </code></pre>
      </section>

      <section id="procedure-status">
        <h2>ProcedureStatus</h2>
        An enumeration of int8 values representing the current state of a procedure execution. If set to FAILED then associated ErrorData is available.
        <pre><code>
        enum: [
            ONGOING = 1,     // in execution of latest call
            SUCCESSFUL = 0,  // terminated successfully in latest call
            FAILED = -1      // terminated due to failure in latest call
        ]
        </code></pre>
      </section>
 
      <section id="supported-protocol">
        <h2>Supported protocols</h2>
        A string array containing names of the supported protocols. The first on the list is set as default,
        which can be changed by <a href="#select-protocol-procedure">SelectProtocol</a> if multiple protocolsa are supported.
        Protocol naming should be "MainProtocolName-SubProtocolName", e. g. "VISSv3.0-grpc".
      </section>
 
      <section id="percentage">
        <h2>Percentage</h2>
        An integer value ranging from zero to one hundred.
        This represents the percentage of the current value within a range calculated as current value / (max range value - min range value).
        The semantics of max and min range values shall be defined in the context of the range being addressed.
        <pre><code>
        uint8
        min = 0
        max = 100
        </code></pre>
      </section>

      <section id="matrix-id">
        <h2>MatrixId</h2>
        A struct containing the Id of one element of a two-dimensional matrix.
        <pre><code>
        struct {
            RowName: string,
            ColumnName: string
        }
        </code></pre>
      </section>

      <section id="ragged-matrix">
        <h2>RaggedMatrix</h2>
        A two-dimensional matrix in which the number of elements may vary in the different rows.
        The matrix is represented as an array of RowDef elements.
        The Rowdef datatype is a struct with one element representing the name of the row,
        and the other is a string array containing the elements of that row.
        <pre><code>
        RowDef: struct {
        {
            RowName: string,
            ColumnName: []string
        }
        RaggedMatrix: []RowDef
        </code></pre>
      </section>

      <section id="seat-movement">
        <h2>SeatMovementType</h2>
        A struct containing the name and description of seat movement types in the vehicle.
        <pre><code>
        struct {
            Name: string,
            Description: string
        }
        </code></pre>
        If any of the following types of movement are supported then these names and descriptions should be used.
          <ul>
            <li>
              <strong>longitudal:</strong>
              Seat movement in the direction parallel to the driving direction.
              Forward/backward movements with max backwards being zero percentage.
            </li>
            <li>
              <strong>lateral:</strong>
              Seat movement in the direction anti-parallel to the driving direction, in the horizontal plane.
              Left/right movements with max left being zero percentage.
            </li>
            <li>
              <strong>vertical:</strong>
              Seat movement in the vertical direction to the driving plane.
              Up/down movements with max down being zero percentage.
            </li>
            <li>
              <strong>tilt:</strong>
              Angular seat movement of the backrest relative the driving plane.
              Tilt/recline movements with max recline being zero percentage.
            </li>
            <li>
              <strong>lumbar:</strong>
              Seat movement of the lumber support.
              Inflate/deflate movements with max deflate being zero percentage.
            </li>
            <li>
              <strong>headrest-vertical:</strong>
              Seat headrest movement the vertical direction to the driving plane.
              Up/down movements with max down being zero percentage.
            </li>
            <li>
              <strong>headrest-tilt:</strong>
              Angular movement of the seat headrest relative to the driving plane.
              Tilt/recline movements with max recline being zero percentage.
            </li>
          </ul>
          Movement types not covered by the list may be added in an implementation.
      </section>

      <section id="service-signature">
        <h2>ServiceSignature</h2>
        A struct describing the procedure signature of an auxillary service.<br>
        The Name member shall be used as the serviceName input parameter when calling <a href="#invoke-procedure">Invoke</a> to perform a call of this service.<br>
        The Input member is a JSON object describing the input parameters of the auxillary service.
        The format described shall be used procedureInput input parameter in the Invoke call.<br>
        The Output member is a JSON object describing the output parameters of the auxillary service.
        This can be helpful when decoding the JSON object that is received in the response (and events if issued) from the service call.
        <pre><code>
        struct {
            Name: string,
            Input: string,
            Output: string
        }
        </code></pre>
      </section>

    </section>
  </body>
</html>
